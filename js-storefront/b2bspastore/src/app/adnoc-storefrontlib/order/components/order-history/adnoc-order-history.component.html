<ng-container
  *ngIf="{
    orderHistory: orders$ | async,
    replenishmentOrder: hasReplenishmentOrder$ | async
  } as type"
>
  <ng-container *ngIf="type.orderHistory">
    <div>
      <!-- HEADER -->
      <div
        [ngClass]="
          type.replenishmentOrder
            ? 'cx-replenishment-details-order-history-header'
            : 'cx-order-history-header'
        "
      >
        <h4 *ngIf="type.replenishmentOrder">
          {{
            "userOrderTranslations.orderHistory.replenishmentHistory"
              | cxTranslate
          }}
        </h4>
        <h2 *ngIf="!type.replenishmentOrder">
          {{ "userOrderTranslations.orderHistory.orderHistory" | cxTranslate }}
        </h2>
      </div>

      <!-- BODY -->
      <div class="cx-order-history-body">
        <ng-container
          *ngIf="
            (type?.orderHistory?.pagination?.totalResults || 0) > 0;
            else noOrder
          "
        >
          <!-- Select Form and Pagination Top -->
          <div class="cx-order-history-sort top">
            <label class="cx-order-history-form-group form-group"
              ><span class="texts-primary">
                {{ "userOrderTranslations.orderHistory.sortBy" | cxTranslate }}
              </span>
              <cx-sorting
                [sortOptions]="type.orderHistory.sorts"
                [sortLabels]="getSortLabels() | async"
                (sortListEvent)="changeSortCode($event)"
                [selectedOption]="type.orderHistory.pagination?.sort"
                placeholder="{{
                  'userOrderTranslations.orderHistory.sortBy' | cxTranslate
                }}"
                [ariaLabel]="
                  'userOrderTranslations.orderHistory.sortOrders' | cxTranslate
                "
                ariaControls="order-history-table"
              ></cx-sorting>
            </label>
            <div
              *ngIf="(type?.orderHistory?.pagination?.totalPages || 0) > 1"
              class="cx-order-history-pagination"
            >
              <cx-pagination
                [pagination]="type.orderHistory.pagination"
                (viewPageEvent)="pageChange($event)"
              ></cx-pagination>
            </div>
          </div>

          <table
            role="table"
            id="order-history-table"
            class="table cx-order-history-table"
            [ngClass]="{ 'cx-order-history-table-po': hasPONumber }"
          >
            <caption class="cx-visually-hidden">
              {{
                "userOrderTranslations.orderHistory.orderHistory" | cxTranslate
              }}
            </caption>
            <thead class="cx-order-history-thead-mobile">
              <tr role="row">
                <th role="columnheader">
                  {{
                    "userOrderTranslations.orderHistory.orderId" | cxTranslate
                  }}
                </th>
                <th role="columnheader">
                  {{
                    "userOrderTranslations.orderHistory.shipToId" | cxTranslate
                  }}
                </th>
                <ng-container *ngIf="hasPONumber">
                  <th role="columnheader">
                    {{
                      "userOrderTranslations.orderHistory.PONumber"
                        | cxTranslate
                    }}
                  </th>
                </ng-container>
                <th role="columnheader">
                  {{
                    "userOrderTranslations.orderHistory.category" | cxTranslate
                  }}
                </th>
                <th role="columnheader">
                  {{ "userOrderTranslations.orderHistory.date" | cxTranslate }}
                </th>
                <th role="columnheader">
                  {{
                    "userOrderTranslations.orderHistory.status" | cxTranslate
                  }}
                </th>
                <th
                  role="columnheader"
                  [innerHTML]="
                    'userOrderTranslations.orderHistory.total' | cxTranslate
                  "
                ></th>
              </tr>
            </thead>
            <tbody>
              <tr
                role="row"
                *ngFor="let order of type.orderHistory.orders"
                (click)="goToOrderDetail(order)"
              >
                <td role="cell" class="cx-order-history-code">
                  <div class="cx-order-history-label">
                    {{
                      "userOrderTranslations.orderHistory.orderId" | cxTranslate
                    }}
                  </div>
                  <a
                    [routerLink]="
                      {
                        cxRoute: 'orderDetails',
                        params: order
                      } | cxUrl
                    "
                    [queryParams]="getQueryParams(order)"
                    class="cx-order-history-value"
                  >
                    {{ order?.code }}</a
                  >
                </td>
                <td role="cell" class="cx-order-history-code">
                  <div class="cx-order-history-label">
                    {{
                      "userOrderTranslations.orderHistory.shipToId"
                        | cxTranslate
                    }}
                  </div>
                  <a
                    [routerLink]="
                      {
                        cxRoute: 'orderDetails',
                        params: order
                      } | cxUrl
                    "
                    [queryParams]="getQueryParams(order)"
                    class="cx-order-history-value"
                  >
                    {{ order?.deliveryAddress?.sapCustomerID }}</a
                  >
                </td>
                <ng-container *ngIf="hasPONumber">
                  <td role="cell" class="cx-order-history-po">
                    <div class="cx-order-history-label">
                      {{
                        "userOrderTranslations.orderHistory.PONumber"
                          | cxTranslate
                      }}
                    </div>
                    <a
                      *ngIf="order.purchaseOrderNumber"
                      [routerLink]="
                        {
                          cxRoute: 'orderDetails',
                          params: order
                        } | cxUrl
                      "
                      [queryParams]="getQueryParams(order)"
                      class="cx-order-history-value"
                    >
                      {{ order.purchaseOrderNumber }}</a
                    >
                  </td>
                </ng-container>
                <td role="cell" class="cx-order-history-cost-center">
                  <div class="cx-order-history-label">
                    {{
                      "userOrderTranslations.orderHistory.category"
                        | cxTranslate
                    }}
                  </div>
                  <ng-container *ngIf="order?.category?.name">
                    <a
                      [routerLink]="
                        {
                          cxRoute: 'orderDetails',
                          params: order
                        } | cxUrl
                      "
                      [queryParams]="getQueryParams(order)"
                      class="cx-order-history-value"
                    >
                      {{ order.category?.name }}
                    </a>
                  </ng-container>
                </td>

                <td role="cell" class="cx-order-history-placed">
                  <div class="cx-order-history-label">
                    {{
                      "userOrderTranslations.orderHistory.date" | cxTranslate
                    }}
                  </div>
                  <a
                    [routerLink]="
                      {
                        cxRoute: 'orderDetails',
                        params: order
                      } | cxUrl
                    "
                    [queryParams]="getQueryParams(order)"
                    class="cx-order-history-value"
                    >{{ order?.placed | cxDate : "longDate" }}</a
                  >
                </td>

                <td role="cell" class="cx-order-history-status">
                  <div class="cx-order-history-label">
                    {{
                      "userOrderTranslations.orderHistory.status" | cxTranslate
                    }}
                  </div>
                  <span class="{{ order.status }}">{{
                    order.statusDisplay
                  }}</span>
                </td>
                <td role="cell" class="cx-order-history-total">
                  <div
                    class="cx-order-history-label"
                    [innerHTML]="
                      'userOrderTranslations.orderHistory.total' | cxTranslate
                    "
                  ></div>
                  <a
                    [routerLink]="
                      {
                        cxRoute: 'orderDetails',
                        params: order
                      } | cxUrl
                    "
                    [queryParams]="getQueryParams(order)"
                    class="cx-order-history-value"
                  >
                    {{ order?.total?.formattedValue }}</a
                  >
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Select Form and Pagination Bottom -->
          <div class="cx-order-history-sort bottom">
            <div
              *ngIf="(type?.orderHistory?.pagination?.totalPages || 0) > 1"
              class="cx-order-history-pagination"
            >
              <cx-pagination
                [pagination]="type.orderHistory.pagination"
                (viewPageEvent)="pageChange($event)"
              ></cx-pagination>
            </div>
          </div>
        </ng-container>

        <!-- NO ORDER CONTAINER -->
        <ng-template #noOrder>
          <div
            *ngIf="isLoaded$ | async"
            [ngClass]="
              type.replenishmentOrder
                ? 'cx-replenishment-details-order-history-no-order'
                : 'cx-order-history-no-order'
            "
          >
            <div>
              <ng-container *ngIf="type.replenishmentOrder; else otherOrder">
                <div>
                  {{
                    "userOrderTranslations.orderHistory.notFound" | cxTranslate
                  }}
                </div>
              </ng-container>

              <ng-template #otherOrder>
                <div>
                  {{
                    "userOrderTranslations.orderHistory.noOrders" | cxTranslate
                  }}
                </div>
                <a
                  [routerLink]="{ cxRoute: 'home' } | cxUrl"
                  routerLinkActive="active"
                  class="btn btn-primary btn-block"
                  >{{
                    "userOrderTranslations.orderHistory.startShopping"
                      | cxTranslate
                  }}</a
                >
              </ng-template>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  </ng-container>
</ng-container>
